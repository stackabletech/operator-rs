---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: listenerclasses.listeners.stackable.tech
spec:
  group: listeners.stackable.tech
  names:
    categories: []
    kind: ListenerClass
    plural: listenerclasses
    shortNames: []
    singular: listenerclass
  scope: Cluster
  versions:
  - additionalPrinterColumns: []
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Auto-generated derived type for ListenerClassSpec via `CustomResource`
        properties:
          spec:
            description: |-
              Defines a policy for how [Listeners](https://docs.stackable.tech/home/nightly/listener-operator/listener) should be exposed.
              Read the [ListenerClass documentation](https://docs.stackable.tech/home/nightly/listener-operator/listenerclass)
              for more information.
            properties:
              loadBalancerAllocateNodePorts:
                default: true
                description: |-
                  Configures whether a LoadBalancer service should also allocate node ports (like NodePort).

                  Ignored unless serviceType is LoadBalancer.
                type: boolean
              loadBalancerClass:
                description: |-
                  Configures a custom Service loadBalancerClass, which can be used to access secondary
                  load balancer controllers that are installed in the cluster, or to provision
                  custom addresses manually.

                  Ignored unless serviceType is LoadBalancer.
                nullable: true
                type: string
              pinnedNodePorts:
                default: false
                description: |-
                  Wether or not a Pod exposed using a NodePort should be pinned to a specific Kubernetes node.

                  By pinning the Pod to a specific (stable) Kubernetes node, stable addresses can be
                  provided using NodePorts. The pinning is achieved by listener-operator setting the
                  `volume.kubernetes.io/selected-node` annotation on the Listener PVC.

                  However, this only works on setups with long-living nodes. If your nodes are rotated on
                  a regular basis, the Pods previously running on a removed node will be stuck in Pending
                  until you delete the PVC with the pinning.

                  Because of this we don't enable pinning by default to support all environments.
                type: boolean
              preferredAddressType:
                default: HostnameConservative
                description: |-
                  Whether addresses should prefer using the IP address (`IP`) or the hostname (`Hostname`).
                  Can also be set to `HostnameConservative`, which will use `IP` for `NodePort` service types, but `Hostname` for everything else.

                  The other type will be used if the preferred type is not available.

                  Defaults to `HostnameConservative`.
                enum:
                - Hostname
                - IP
                - HostnameConservative
                type: string
              serviceAnnotations:
                additionalProperties:
                  type: string
                default: {}
                description: Annotations that should be added to the Service object.
                type: object
              serviceExternalTrafficPolicy:
                default: Local
                description: |-
                  `externalTrafficPolicy` that should be set on the created [`Service`] objects.

                  The default is `Local` (in contrast to `Cluster`), as we aim to direct traffic to a node running the workload
                  and we should keep testing that as the primary configuration. Cluster is a fallback option for providers that
                  break Local mode (IONOS so far).
                enum:
                - Cluster
                - Local
                type: string
              serviceType:
                description: The method used to access the services.
                enum:
                - NodePort
                - LoadBalancer
                - ClusterIP
                type: string
            required:
            - serviceType
            type: object
        required:
        - spec
        title: ListenerClass
        type: object
    served: true
    storage: true
    subresources: {}
